{"version":3,"file":"SeiWalletProvider.js","names":["_react","_interopRequireWildcard","require","_components","_helpers","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","SeiWalletContext","createContext","chainId","restUrl","rpcUrl","accounts","connect","undefined","disconnect","setConnectionError","setTargetWallet","setShowConnectModal","wallets","exports","SeiWalletProvider","_ref","children","chainConfiguration","autoConnect","autoConnectSeiWallet","findWalletByWindowKey","_useState","useState","_useState2","_slicedToArray2","targetWallet","_useState3","_useState4","offlineSigner","setOfflineSigner","_useState5","_useState6","connectionError","_useState7","_useState8","setAccounts","_useState9","_useState10","showConnectModal","_useState11","_useState12","connectedWallet","setConnectedWallet","filteredWallets","reduce","acc","wallet","seiWallet","push","connectToChain","_ref2","_asyncToGenerator2","_regenerator","mark","_callee","enableResponse","fetchedOfflineSigner","fetchedAccounts","wrap","_callee$","_context","prev","next","abrupt","window","walletInfo","windowKey","sent","getOfflineSigner","getAccounts","length","t0","console","error","stop","apply","arguments","useEffect","then","contextValue","createElement","Provider","value","WalletSelectModal","_default"],"sources":["../../../src/lib/provider/SeiWalletProvider.tsx"],"sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\nimport { AccountData, OfflineSigner } from '@cosmjs/proto-signing';\nimport { SeiWalletProviderProps, WalletProvider } from './types';\nimport { WalletSelectModal } from '../components';\nimport { SeiWallet } from '@sei-js/core';\nimport { findWalletByWindowKey } from './helpers';\n\nexport const SeiWalletContext = createContext<WalletProvider>({\n\tchainId: '',\n\trestUrl: '',\n\trpcUrl: '',\n\taccounts: [],\n\tconnect: () => undefined,\n\tdisconnect: () => undefined,\n\tsetConnectionError: () => undefined,\n\tsetTargetWallet: () => undefined,\n\tsetShowConnectModal: () => undefined,\n\twallets: []\n});\n\nconst SeiWalletProvider = ({ children, chainConfiguration, wallets, autoConnect }: SeiWalletProviderProps) => {\n\tconst autoConnectSeiWallet = typeof autoConnect === 'string' ? findWalletByWindowKey(autoConnect) : autoConnect;\n\n\tconst [targetWallet, setTargetWallet] = useState<SeiWallet | undefined>(autoConnectSeiWallet);\n\tconst [offlineSigner, setOfflineSigner] = useState<OfflineSigner>();\n\tconst [connectionError, setConnectionError] = useState<string>();\n\tconst [accounts, setAccounts] = useState<readonly AccountData[]>([]);\n\tconst [showConnectModal, setShowConnectModal] = useState<boolean>(false);\n\tconst [connectedWallet, setConnectedWallet] = useState<SeiWallet | undefined>();\n\n\tconst filteredWallets = wallets.reduce((acc: SeiWallet[], wallet) => {\n\t\tconst seiWallet = typeof wallet === 'string' ? findWalletByWindowKey(wallet) : wallet;\n\t\tif (seiWallet !== undefined) acc.push(seiWallet);\n\t\treturn acc;\n\t}, []);\n\n\tconst disconnect = () => {\n\t\tsetTargetWallet(undefined);\n\t\tsetOfflineSigner(undefined);\n\t\tsetAccounts([]);\n\t\tsetConnectedWallet(undefined);\n\t};\n\n\tconst connectToChain = async () => {\n\t\tif (!targetWallet) return;\n\n\t\ttry {\n\t\t\tif (!window[targetWallet.walletInfo.windowKey as never]) {\n\t\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst enableResponse = await targetWallet.connect(chainConfiguration.chainId);\n\t\t\tconst fetchedOfflineSigner = await targetWallet.getOfflineSigner(chainConfiguration.chainId);\n\n\t\t\tif (!fetchedOfflineSigner) {\n\t\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\t\tdisconnect();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst fetchedAccounts = await targetWallet.getAccounts(chainConfiguration.chainId);\n\n\t\t\tif (fetchedAccounts.length === 0) {\n\t\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\t\tdisconnect();\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tsetShowConnectModal(false);\n\t\t\t\tsetOfflineSigner(fetchedOfflineSigner);\n\t\t\t\tsetAccounts(fetchedAccounts);\n\t\t\t\tsetConnectedWallet(targetWallet);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Error connecting to wallet', e);\n\t\t\tsetConnectionError(targetWallet.walletInfo.windowKey);\n\t\t\treturn;\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tif (targetWallet) {\n\t\t\tconnectToChain().then();\n\t\t} else {\n\t\t\tsetOfflineSigner(undefined);\n\t\t\tsetAccounts([]);\n\t\t\tsetConnectedWallet(undefined);\n\t\t}\n\t}, [targetWallet, chainConfiguration.chainId]);\n\n\tconst contextValue: WalletProvider = {\n\t\tchainId: chainConfiguration.chainId,\n\t\trestUrl: chainConfiguration.restUrl,\n\t\trpcUrl: chainConfiguration.rpcUrl,\n\t\twallets: filteredWallets,\n\t\tconnect: setTargetWallet,\n\t\tdisconnect,\n\t\taccounts,\n\t\tofflineSigner,\n\t\tconnectedWallet,\n\t\ttargetWallet,\n\t\tsetTargetWallet,\n\t\tshowConnectModal,\n\t\tsetShowConnectModal,\n\t\tconnectionError,\n\t\tsetConnectionError\n\t};\n\n\treturn (\n\t\t<SeiWalletContext.Provider value={contextValue}>\n\t\t\t{children}\n\t\t\t<WalletSelectModal wallets={filteredWallets} />\n\t\t</SeiWalletContext.Provider>\n\t);\n};\n\nexport default SeiWalletProvider;\n"],"mappings":"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"}